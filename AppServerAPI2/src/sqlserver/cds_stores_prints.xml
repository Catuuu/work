<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cds_stores_prints">

    <!--门店用户登录验证-->
    <select id="storesLoginVerify" parameterType="CdsUsers" resultType="CdsUsers">
        <![CDATA[
            select u.id,u.user_login,u.user_pass,u.user_nicename,u.stores_id,u.user_status from cds_users u
            left join cds_role_user r
            on r.user_id = u.id
            where u.user_login = #{user_login} and r.role_id = '3'
        ]]>

    </select>

    <select id="getUnPrintInfo" resultType="CdsOrderInfo">
        <![CDATA[
            select top 1 * from cds_order_info
            where  DATEDIFF(minute,create_date,getDate()) >= 2
            and isstoresprint = 0
           	and  create_date > CONVERT(varchar(100), GETDATE(), 23)
        ]]>
    </select>

    <select id="getName" parameterType="CdsStores" resultType="CdsStores">
        select name from cds_stores where stores_id = #{stores_id}
    </select>

    <!--打印机信息-->
    <select id="getPrints" parameterType="HashMap" resultType="HashMap">
        SELECT
          p.print_name,
          p.print_id,
          p.print_address AS print_ip,
          p.brand_id,
          b.brand_name,
          isnull(sb.service_phone,'4000-555-177') as service_phone
        FROM cds_prints p
          LEFT JOIN cds_brand b ON b.brand_id = p.brand_id
          LEFT JOIN cds_stores_brand sb ON sb.brand_id = b.brand_id
        WHERE p.stores_id = #{stores_id} AND sb.stores_id = #{stores_id} AND p.status = 1 AND p.print_model = 2
    </select>

</mapper>