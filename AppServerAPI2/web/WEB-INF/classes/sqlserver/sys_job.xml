<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sys_job">
   <insert id="insertMemberRecord">
         <![CDATA[
            insert into cds_member_report(stores_id,brand_id,report_time,
            member_count1,member_count2,member_count3,member_count4,member_count5,
            eleme_member_count1,eleme_member_count2,eleme_member_count3,eleme_member_count4,eleme_member_count5,
            meituan_member_count1,meituan_member_count2,meituan_member_count3,meituan_member_count4,meituan_member_count5,
            baidu_member_count1,baidu_member_count2,baidu_member_count3,baidu_member_count4,baidu_member_count5,
            weixin_member_count1,weixin_member_count2,weixin_member_count3,weixin_member_count4,weixin_member_count5
            )
            select
            s.stores_id,
            s.brand_id,
            convert(char(10),dateadd(day,-1,getdate()),120) as report_time,
            (select COUNT(1) from cds_member_stores r where r.first_order_time>convert(char(10),dateadd(day,-31,getdate()),120) and r.stores_id=s.stores_id and r.brand_id=s.brand_id) member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time>convert(char(10),dateadd(day,-31,getdate()),120)  and r.stores_id=s.stores_id and r.brand_id=s.brand_id) member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59'  and r.stores_id=s.stores_id and r.brand_id=s.brand_id) member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59'  and r.stores_id=s.stores_id and r.brand_id=s.brand_id) member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59'  and r.stores_id=s.stores_id and r.brand_id=s.brand_id) member_count5,

            (select COUNT(1) from cds_member_stores r where r.first_order_time1>convert(char(10),dateadd(day,-31,getdate()),120)   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) eleme_member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time1>convert(char(10),dateadd(day,-31,getdate()),120)  and r.stores_id=s.stores_id and r.brand_id=s.brand_id) eleme_member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time1>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time1<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59'   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) eleme_member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time1>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time1<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59'   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) eleme_member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time1>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time1<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59'   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) eleme_member_count5,

            (select COUNT(1) from cds_member_stores r where r.first_order_time2>convert(char(10),dateadd(day,-31,getdate()),120)  and r.stores_id=s.stores_id and r.brand_id=s.brand_id) meituan_member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time2>convert(char(10),dateadd(day,-31,getdate()),120)  and r.stores_id=s.stores_id and r.brand_id=s.brand_id) meituan_member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time2>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time2<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59'   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) meituan_member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time2>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time2<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59'   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) meituan_member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time2>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time2<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59'   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) meituan_member_count5,

            (select COUNT(1) from cds_member_stores r where r.first_order_time3>convert(char(10),dateadd(day,-31,getdate()),120)   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) baidu_member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time3>convert(char(10),dateadd(day,-31,getdate()),120)   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) baidu_member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time3>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time3<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59'   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) baidu_member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time3>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time3<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59'   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) baidu_member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time3>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time3<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59'   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) baidu_member_count5,

            (select COUNT(1) from cds_member_stores r where r.first_order_time4>convert(char(10),dateadd(day,-31,getdate()),120)   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) weixin_member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time4>convert(char(10),dateadd(day,-31,getdate()),120)  and r.stores_id=s.stores_id and r.brand_id=s.brand_id) weixin_member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time4>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time4<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59'   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) weixin_member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time4>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time4<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59'   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) weixin_member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time4>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time4<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59'   and r.stores_id=s.stores_id and r.brand_id=s.brand_id) weixin_member_count5

            from cds_stores_brand s
            union all
            select
            0 as stores_id,
            2 as brand_id,
            convert(char(10),dateadd(day,-1,getdate()),120) as report_time,
            (select COUNT(1) from cds_member_stores r where r.first_order_time>convert(char(10),dateadd(day,-31,getdate()),120)  and r.brand_id=2) member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time>convert(char(10),dateadd(day,-31,getdate()),120)  and r.brand_id=2) member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59'   and r.brand_id=2) member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59'   and r.brand_id=2) member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59'   and r.brand_id=2) member_count5,

            (select COUNT(1) from cds_member_stores r where r.first_order_time1>convert(char(10),dateadd(day,-31,getdate()),120)    and r.brand_id=2) eleme_member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time1>convert(char(10),dateadd(day,-31,getdate()),120)    and r.brand_id=2) eleme_member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time1>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time1<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59'   and r.brand_id=2) eleme_member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time1>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time1<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59'   and r.brand_id=2) eleme_member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time1>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time1<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59'   and r.brand_id=2) eleme_member_count5,

            (select COUNT(1) from cds_member_stores r where r.first_order_time2>convert(char(10),dateadd(day,-31,getdate()),120)    and r.brand_id=2 ) meituan_member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time2>convert(char(10),dateadd(day,-31,getdate()),120)    and r.brand_id=2) meituan_member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time2>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time2<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59'   and r.brand_id=2) meituan_member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time2>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time2<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59'   and r.brand_id=2) meituan_member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time2>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time2<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59'   and r.brand_id=2) meituan_member_count5,

            (select COUNT(1) from cds_member_stores r where r.first_order_time3>convert(char(10),dateadd(day,-31,getdate()),120)   and r.brand_id=2) baidu_member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time3>convert(char(10),dateadd(day,-31,getdate()),120)   and r.brand_id=2) baidu_member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time3>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time3<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59'   and r.brand_id=2) baidu_member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time3>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time3<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59'   and r.brand_id=2) baidu_member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time3>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time3<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59'   and r.brand_id=2) baidu_member_count5,

            (select COUNT(1) from cds_member_stores r where r.first_order_time4>convert(char(10),dateadd(day,-31,getdate()),120)  and r.brand_id=2) weixin_member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time4>convert(char(10),dateadd(day,-31,getdate()),120)  and r.brand_id=2) weixin_member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time4>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time4<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59' and r.brand_id=2) weixin_member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time4>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time4<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59' and r.brand_id=2) weixin_member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time4>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time4<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59' and r.brand_id=2) weixin_member_count5

            union all
            select
            0 as stores_id,
            1 as brand_id,
            convert(char(10),dateadd(day,-1,getdate()),120) as report_time,
            (select COUNT(1) from cds_member_stores r where r.first_order_time>convert(char(10),dateadd(day,-31,getdate()),120)  and r.brand_id=1) member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time>convert(char(10),dateadd(day,-31,getdate()),120)  and r.brand_id=1) member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59'   and r.brand_id=1) member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59'   and r.brand_id=1) member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59'   and r.brand_id=1) member_count5,

            (select COUNT(1) from cds_member_stores r where r.first_order_time1>convert(char(10),dateadd(day,-31,getdate()),120)    and r.brand_id=1) eleme_member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time1>convert(char(10),dateadd(day,-31,getdate()),120)    and r.brand_id=1) eleme_member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time1>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time1<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59'   and r.brand_id=1) eleme_member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time1>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time1<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59'   and r.brand_id=1) eleme_member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time1>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time1<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59'   and r.brand_id=1) eleme_member_count5,

            (select COUNT(1) from cds_member_stores r where r.first_order_time2>convert(char(10),dateadd(day,-31,getdate()),120)    and r.brand_id=1 ) meituan_member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time2>convert(char(10),dateadd(day,-31,getdate()),120)    and r.brand_id=1) meituan_member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time2>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time2<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59'   and r.brand_id=1) meituan_member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time2>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time2<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59'   and r.brand_id=1) meituan_member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time2>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time2<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59'   and r.brand_id=1) meituan_member_count5,

            (select COUNT(1) from cds_member_stores r where r.first_order_time3>convert(char(10),dateadd(day,-31,getdate()),120)   and r.brand_id=1) baidu_member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time3>convert(char(10),dateadd(day,-31,getdate()),120)   and r.brand_id=1) baidu_member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time3>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time3<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59'   and r.brand_id=1) baidu_member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time3>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time3<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59'   and r.brand_id=1) baidu_member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time3>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time3<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59'   and r.brand_id=1) baidu_member_count5,

            (select COUNT(1) from cds_member_stores r where r.first_order_time4>convert(char(10),dateadd(day,-31,getdate()),120)  and r.brand_id=1) weixin_member_count1,
            (select COUNT(1) from cds_member_stores r where r.last_order_time4>convert(char(10),dateadd(day,-31,getdate()),120)  and r.brand_id=1) weixin_member_count2,
            (select COUNT(1) from cds_member_stores r where r.last_order_time4>convert(char(10),dateadd(day,-61,getdate()),120) and r.last_order_time4<convert(char(10),dateadd(day,-31,getdate()),120)+' 23:59' and r.brand_id=1) weixin_member_count3,
            (select COUNT(1) from cds_member_stores r where r.last_order_time4>convert(char(10),dateadd(day,-91,getdate()),120) and r.last_order_time4<convert(char(10),dateadd(day,-61,getdate()),120)+' 23:59' and r.brand_id=1) weixin_member_count4,
            (select COUNT(1) from cds_member_stores r where r.first_order_time4>convert(char(10),dateadd(day,-1,getdate()),120) and r.first_order_time4<convert(char(10),dateadd(day,-1,getdate()),120)+' 23:59' and r.brand_id=1) weixin_member_count5
         ]]>
     </insert>
</mapper>