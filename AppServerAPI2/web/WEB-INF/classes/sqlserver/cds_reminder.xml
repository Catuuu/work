<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cds_reminder">
    <!--催单列表-->
    <select id="geReminderList" parameterType="PageParam" resultType="HashMap">
        <![CDATA[
            select (d.name)as stores_name,c.brand_name,a.cr_id,(a.order_id)as id,a.reminder_id,a.do_status,a.cr_remark,a.cr_time,a.cr_user_id,a.cr_check_time,a.cr_check_remark,(a.stores_id)as sid,a.times,a.address,a.type,b.* from cds_reminder a
            left join cds_order_info b on a.order_id = b.order_desc
            left join cds_brand c on b.brand_id = c.brand_id
            left join cds_stores d on b.stores_id = d.stores_id
            where DateDiff(dd,pay_time,getdate())=0
        ]]>
            <if test="formInfo.stores_id != null and formInfo.stores_id != '' ">
                <![CDATA[
                        AND (
                             a.stores_id = #{formInfo.stores_id}
                          )
                    ]]>
            </if>
            <if test="formInfo.type != null and formInfo.type != '' ">
                <![CDATA[
                        AND (
                             a.type = #{formInfo.type}
                          )
                    ]]>
            </if>
            <if test="formInfo.do_status != null and formInfo.do_status != '' ">
                <![CDATA[
                        AND (
                             a.do_status = #{formInfo.do_status}
                          )
                    ]]>
            </if>
            <if test="formInfo.fromin != null and formInfo.fromin != '' ">
                <![CDATA[
                        AND (
                             b.fromin = #{formInfo.fromin}
                          )
                    ]]>
            </if>
    </select>

    <select id="getRole" parameterType="CdsUsers" resultType="HashMap">
        <![CDATA[
            select * from cds_auth_access where role_id in (select a.id from cds_role a left join cds_role_user b on a.id=b.role_id where  b.user_id = #{id}) and rule_name = 'shop/reminder/index'
        ]]>

    </select>

    <select id="getCount" parameterType="PageParam" resultType="Map">
        <![CDATA[
            select count(1) as allcount  from cds_reminder where DateDiff(dd,cr_time,getdate())=0 and do_status=1
        ]]>

    </select>


</mapper>